10514 이서준
WASM 메모리 분석을 통한 온라인 게임 리버스 엔지니어링.
가끔씩 심심할때마다 하는 온라인게임 diep io 에서 서버가 js 가 아닌 wasm으로 구동되고 실행된다는것에 호기심을 느꼈다. 
어떤식으로 게임이 정보를 받고 동작하는지 합법적 범위 내에서 시도하고, 찾은것을 운영팀과 공유하여 알렸다.


diep io 에서 플레이어 정보, 시야값, 위치값, 스텟값과 탱크 정보등을 모두 동적인 wasm heap 에 저장한다. 여기서  WebAssembly.instantiate 및 WebAssembly.instatiateStreaming 함수 래핑하여 WASM 가로챈다음, 게임 관련 메인 정보가 담겨있는 f32를 스캔한다. 여기는 플레이어 좌표 fov및 1등의 좌표등이 들어있다. 저기서 unknown 을 찾은다음, 0인값을 제외하면 180000개의 값이 뜬다.
그중 FOV(field of view 를 찾고싶다고 하자. diep io 에서는 FOV 값이 기본 0.5500 에서 시작하여 0.5500 ->> 0.5473 ->> 0.5446 _>> 0.5419 이렇게 레벨업을 할때마다 미세하게 감소한다는걸 알아챘다.
FOV가 변할 때 특정 메모리 주소의 값이 주기적으로 변함
→ 이를 단서로 메모리 추적 가능

게임 실행

FOV에 변화가 생기는 상황 만들기

탱크 업그레이드 시 확대/축소

미니맵 사용 등
이후 FOV 변화 시점마다

Increased value, Decreased value, Changed value 반복 필터링하여 fov값이나 시야, 카메라 앵글과 관련된 값을 필터링한다.

후보 주소가 좁혀지면 주소 고정(Freeze) 후 값 조작
→ 화면 줌 변화가 실제로 일어나면 해당 주소가 FOV 변수.

그러나.. 
wasm 모듈은 메모리확장, 힙 재배치등이 새로고침할때마다 일어나기에 이번게임의 절대주소인 저 값을 찾고 수정하는것에는 의미가 없었음.
그래서 f32메모리 안에서도 계속해서 서버가 업데이트하는 좌표, 속도, hp,ㄹfov 등의 값이 모여있는 player 구조체를 찾았고, 그 근처를 찾으며 구조체의 시작이자 맵 데이터같이 변하지 않는 값을 골라 기준값으로 선정하였다.
구조체의 주소는 계속해서 바뀌지만, 객체 안에서 데이터가 나열된 offset은 바뀌지 않는다는것을 사용하여
FOV 값이 항상 player 기준값 시작에서 +77 offset에 있다는것을 알아내었다. 
이로써 indexof로 magicnumber을 매 게임마다 자동으로 찾으면, 메모리가 재할당되어도 그 게임내에서 처음으로 시작하는 player 구조체의 시작점을 찾을수있었고, 그 값에 구조체 내부 상대 오프셋을 더하여 FOV값을 고정적으로 찾을수있ㄱ데되었다. 


이걸 간단하게 막을수있을까? 
내가 게임에서 구조체의 시작점이나 fov값을 특정하기 쉬웠던 이유가 메모리에 0.5500 ->> 0.5473 ->> 0.5446 _>> 0.5419 이런식으로 원본 float값이 인식하기 쉽게  존재했기때문이다. 여기서 내가 수학시간에 심화탐구한 xor 기반 암호화를 사용하면 될것같다.
공격자는 고정 float을 스캔하려고 시도

근데 XOR된 값은 완전 다른 숫자

FOV=3.2 일 때 저장 값이 1.072389e-12 같은 무작위 float이 됨
→ indexOf로 절대 못 찾음각각 XOR 되어 있으니
값 패턴 자체가 없어짐

스캐너가 의미 있는 연속 데이터를 못 잡음

공격자는 보통 특정 패턴(예: 플레이어 구조체)으로 찾기에.


실제로 xor은 매우 간단한 연산과정이고 컴퓨터 자원을 많이 소비하지 않을뿐더러 wasm에서는 거의 네이티브 속도로 작동하기에 게임에 영향을 끼치지 않고 메모리 분석으로 값을 조작하는것을 막을수있다.


모두 게임 개발사와 공식으로소통을 하여 허락을 받고 진행하였으며 과정을 공유하여 개발사에 도움을줌.


모두 게임 개발사와 공식적으로 소통하여 허락을 받고 진행하였으며, 분석 과정에서 확인된 문제점과 개선 방안을 개발사 측과 공유하였다. 본 탐구는 게임의 허가되지 않은 조작이나 악용이 아닌, 기술적 구조를 이해하고 보안적 취약점을 개선하는 데 목적을 두고 윤리적인 방식으로 수행되었다.



